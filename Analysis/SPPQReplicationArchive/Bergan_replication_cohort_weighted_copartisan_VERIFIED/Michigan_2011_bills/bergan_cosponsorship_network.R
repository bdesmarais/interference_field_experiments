
rm(list=ls())
gc()

library(foreign)

setwd("~/Dropbox/professional/Research/Active/causalityinnetworks-agenda/Interference_in_Field_Experiments/Analysis/Bergan_replication/") # bruce
setwd("D:/Dropbox/Interference_in_Field_Experiments/Analysis/Bergan_replication/") # sayali

bergDat <- read.dta("bergan.dta")

cosponsor_data <- read.csv("./Michigan_2011_bills/Search Results - Generated by Quorum.csv",stringsAsFactors=F)

cosponsor_data <- read.csv("./Michigan_2011_bills/Michigan_2011_bills.csv",stringsAsFactors=F)


words <- function(x){
	words <- strsplit(x," ")[[1]]
	words <- words[which(nchar(words)>3)]
	words <- removePunctuation(words)
	words
}

cosponsorship_network <- matrix(0,nrow(bergDat),nrow(bergDat))

for(i in 1:nrow(cosponsor_data)){
	# construct vector of cosopnsors
	cosponsorsi <- strsplit(c(cosponsor_data[i,c("Cosponsors")]),",")[[1]]
	# add the main sponsor to the vector of cosponsors
	cosponsorsi <- c(cosponsorsi,strsplit(c(cosponsor_data[i,c("Sponsor.s.")]),",")[[1]])
	# loop over bergan nodes to see if they are in the cosponsorship list
	if(length(cosponsorsi) > 1){
		nodes_in_cosponsors <- NULL
		for(j in 1:nrow(bergDat)){
			if(nchar(bergDat$name[j])>2){
			# break bergan name into word
			berg_wordsj <- words(bergDat$name[j])
			print(berg_wordsj)
			for(k in 1:length(cosponsorsi)){
				# break cosponsorship name into words
				cosp_wordsk <- words(cosponsorsi[k])
				print(cosp_wordsk)
				# check that first and last bergan can be found in first and last cosponsor
				if(all(is.element(tolower(berg_wordsj),tolower(cosp_wordsk)))) nodes_in_cosponsors <- c(nodes_in_cosponsors,j)
			}
			}
		}
		# put cosponsor pairs into adjacency matrix
		if(length(nodes_in_cosponsors)>1){
			for(j in 2:length(nodes_in_cosponsors)){
				for(k in 1:(j-1)){
					cosponsorship_network[nodes_in_cosponsors[j],nodes_in_cosponsors[k]] <- cosponsorship_network[nodes_in_cosponsors[j],nodes_in_cosponsors[k]] + 1 
					cosponsorship_network[nodes_in_cosponsors[k],nodes_in_cosponsors[j]] <- cosponsorship_network[nodes_in_cosponsors[k],nodes_in_cosponsors[j]] + 1 
				}
			}
		}
	}
	}

# plot the cosponsorship network
library(sna)
gplot(cosponsorship_network)
rownames(cosponsorship_network) <- bergDat$name
colnames(cosponsorship_network) <- bergDat$name

save(list="cosponsorship_network",file="./Michigan_2011_bills/cosponsorship_network.RData")


